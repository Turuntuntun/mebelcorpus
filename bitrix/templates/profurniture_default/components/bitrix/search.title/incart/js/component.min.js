"use strict";(function(a){"use strict";a.RS=a.RS||{},a.RS.Vue=a.RS.Vue||{},a.RS.Vue.Components=a.RS.Vue.Components||{};var b=a.BX,c=a.RS;if(b.Vue.use(a.Toasted),!c.Vue.Components.SuggestionItems){var d={template:"\n            <div class=\"suggestion-items\">\n            \n                <div class=\"suggestion-items__form suggestion-items-form\">\n                    <input\n                        ref=\"input\"\n                        type=\"text\"\n                        class=\"form-control suggestion-items-form__input\"\n                        v-model=\"query\"\n                        :id=\"inputId\"\n                        :placeholder=\"placeholder\"\n                        @focus=\"handleFocus\"\n                        @blur=\"handleBlur\"\n                        @keydown.down=\"handleDown\"\n                        @keydown.up=\"handleUp\"\n                        @keydown.enter.prevent=\"handleEnter\"\n                        @input=\"handleInput\"\n                    >\n\n                    <button\n                        :disabled=\"!!!item.id\" \n                        @click.prevent=\"add(item)\" \n                        class=\"btn btn-primary suggestion-items-form__button\" \n                        ref=\"button\"\n                    > \n                        {{ buttonTitle }}\n                    </button>\n                </div>\n                \n                <div v-show=\"isShowPopup\" class=\"suggestion-items__popup suggestion-items-popup\" ref=\"popup\" :class=\"{'is-processing': isProcessing}\">\n\n                    <ul v-if=\"items.length > 0\" class=\"list-unstyled suggestion-items-list\" :class=\"{'invisible': isProcessing}\">\n                        <li v-for=\"(item, index) in items\" :key=\"item.id\" class=\"suggestion-items-list-item\" :class=\"{active: active == index}\">\n                            <a v-if=\"!item.hasOffers\" href=\"#\" @mouseenter=\"setActive(index)\"  @click.prevent=\"selectItem(item)\" class=\"suggestion-items-list-item__link\">\n                                \n                                <span v-if=\"item.picture\" class=\"suggestion-items-list-item__pic\">\n                                    <img class=\"icon\" :src=\"item.picture.src\" :alt=\"item.name\" :title=\"item.name\">\n                                </span>\n                                <span v-else-if=\"item.isOffer && data[item.parentId] && data[item.parentId].picture\" class=\"suggestion-items-list-item__pic\">\n                                    <img class=\"icon\" :src=\"data[item.parentId].picture.src\" :alt=\"item.name\" :title=\"item.name\">\n                                </span>\n\n                                <span class=\"suggestion-items-list-item__title\"> \n                                    <span v-html=\"item.phrase\" class=\"suggestion-items-list-item__phrase\"></span>\n                                    <span class=\"nowrap\" v-if=\"item.priceValue\">\n                                        <span class=\"suggestion-items-list-item__price\">{{ localize.RS_SUGGEST_ITEMS_PRICE }}: </span> \n                                        <span class=\"suggestion-items-list-item__price-val\"> {{ item.price }} </span> \n                                    </span>\n                                </span>\n                            </a>\n                        </li>\n                    </ul>\n                    <div v-else-if=\"!isProcessing\">\n                        <div class=\"suggestion-items-popup__empty\">{{ localize.RS_SUGGEST_ITEMS_NOT_FOUND }}</div>\n                    </div>\n\n                    <div class=\"area2darken\" v-if=\"isProcessing\"><i class=\"icon animashka\"></i></div>\n                </div>\n\t\t\t</div>\n        ",props:{minLength:Number,inputId:String,ajaxPath:String,placeholder:String,value:String,buttonTitle:String},data:function(){return{isFocused:!1,data:{},cachedData:{},item:{},query:this.value,isProcessing:!0,active:-1}},mounted:function(){var a=this,b=function(b){if(a.isFocused){var c=b.target;c==a.$el||a.$el.contains(c)||(a.$refs.input.blur(),a.isFocused=!1)}};document.addEventListener("mouseup",b),document.addEventListener("touchstart",b),document.addEventListener("keydown",function(b){var c=b.key;a.isFocused&&"Escape"==c&&(a.isFocused=!1,a.$refs.input.blur())})},methods:{handleFocus:function(){this.isFocused=!0},handleBlur:function(a){var b=a.relatedTarget;b?b!=this.$refs.popup&&!this.$refs.popup.contains(b)&&(this.isFocused=!1):this.isFocused=!1,!this.isFocused&&this.item.id&&this.query!=this.item.name&&(this.query=this.item.name)},handleDown:function(){this.active>=this.items.length-1?this.setActive(-1):this.setActive(this.active+1)},handleUp:function(){-1>=this.active?this.setActive(this.items.length-1):this.setActive(this.active-1)},handleEnter:function(){-1<this.active?this.items[this.active]&&this.selectItem(this.items[this.active]):this.item.id&&this.add(this.item)},handleInput:function(a){a.target.value!=this.query&&(this.query=a.target.value),this.$emit("input",this.query)},setActive:function(a){this.active=a},loadData:function(a){var c=this;return new Promise(function(d){var e={ajax_call:"y",INPUT_ID:c.inputId,q:a,l:c.minLength};b.ajax({url:c.ajaxPath,method:"POST",data:e,dataType:"json",onsuccess:function(a){d(a)}})})},getData:function(a){var b=this;return new Promise(function(c){b.cachedData[a]?c(b.cachedData[a]):b.loadData(a).then(function(c){return b.cachedData[a]=c}).then(function(a){return c(a)})})},selectItem:function(a){var b=this;setTimeout(function(){b.$refs.input.blur(),b.$refs.button.focus(),b.isFocused=!1}),this.query=a.name,this.$emit("input",this.query),this.item=a},add:function(a){this.$emit("add",a),this.item={}},updateData:b.debounce(function(a){var b=this;this.getData(a).then(function(c){a==b.query&&(b.data=c||[],b.isProcessing=!1)})},250)},computed:{localize:function(){return b.Vue.getFilteredPhrases("RS_SUGGEST_ITEMS_")},isShowPopup:function(){return this.isFocused&&this.query.length>this.minLength&&this.query!=this.item.name},items:function(){return(this.data?b.util.array_values(this.data):[]).filter(function(a){return!a.hasOffers})}},watch:{query:function(a){a.length>=this.minLength?(this.isProcessing=!0,this.updateData(a)):(this.isProcessing=!1,this.data=[])},value:function(a){this.query=a}}};c.Vue.Components.SuggestionItems=d}})(window);